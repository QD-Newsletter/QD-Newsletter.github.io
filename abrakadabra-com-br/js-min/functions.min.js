!function(){var e="close";$(document).ready(function(){var n=$(".newsletter-bar-qd-v1");n.find(".newsletter-bar-qd-v1-close").click(function(){n.toggleClass("qd-active"),window.parent.postMessage("QdSn1Msg|"+e,"*")}),n.addClass("qd-active"),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}),$(function(){var e=$("form"),n="petmeupet",a="NL",t=e.find("[name=qd_email]"),i=$(".newsletter-bar-qd-v1");e.validate({rules:{email:{email:!0}},submitHandler:function(e){var c=$(e);if(c.valid()){var o=c.find("[name]");t=t.filter(o),c.addClass("qd-loading");var s=function(e){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){s(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){s(e.ip)},error:function(e){s(null)}})}});var o=c.serializeObject(),s=function(s){o.userId=e,o.ip=s,o.id=(t.val()||"").toLowerCase().replace(/[^a-z0-9]/gi,function(e){return"-"+e.charCodeAt(0)+"-"}),$.ajax({url:"//api.vtexcrm.com.br/"+n+"/dataentities/"+a+"/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(o),success:function(e){i.addClass("qd-success"),c.trigger("QD.crmSuccess",[e])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){c.removeClass("qd-loading")}})}};return $.ajax({url:"//api.vtexcrm.com.br/"+n+"/dataentities/CL/search?_fields=id&email="+(t.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){s(e.length?e[0].id:null)},error:function(){s(null)}}),!1}},errorPlacement:function(e,n){}})}),$(window).on("QD.crmSuccess",function(n,a){e="success"})}();
