!function(){var a="close";$(document).ready(function(){var e=$(".qd-v1-modal-newsletter");e.modal(),e.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn2Msg|"+a,"*")})}),$(function(){var e=$("form"),s=JSON.parse((decodeURIComponent(window.location.search).match(/code=([^&]+)/)||[""]).pop()||"{}");e.find('input[name="name"]').val(s.name||""),e.find('input[name="lastname"]').val(s.lastname||""),e.find('input[name="cpf"]').val(s.cpf||""),e.find('input[name="street"]').val(s.street||""),e.find('input[name="number"]').val(s.number||""),e.find('input[name="apartment"]').val(s.apartment||""),e.find('input[name="cep"]').val(s.cep||""),e.find('input[name="cellphone"]').val((s.cellphone||"").substring(3)),e.find('input[name="city"]').val(s.city||""),e.find('select[name="state"]').val(s.state||""),e.find('input[name="email"]').val(s.email||""),e.find('input[name="weddingAnniversary"], input[name="birthdate"]').mask("00/00/0000"),e.find('input[name="rg"]').mask("00.000.000-0"),e.find('input[name="cpf"]').mask("000.000.000-00"),e.find('input[name="cpf"]').mask("000.000.000-00"),e.find('input[name="cep"]').mask("00000-000"),e.find('input[name="homePhone"]').mask("(00) 0000-0000"),e.find('input[name="cellphone"]').mask(function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},{onKeyPress:function(e,n,a,t){a.mask(SPMaskBehavior.apply({},arguments),t)}}),e.validate({rules:{email:{email:!0}},submitHandler:function(e){var n=$(e);if(n.valid()){var a=n.find('input[name="weddingAnniversary"], input[name="birthdate"]'),t=!1;if(a.each(function(){var e=$(this);moment(e.val(),"DD/MM/YYYY",!0).isValid()||(e.addClass("error"),e.is("[required]")&&(t=!0))}),t)return!1;n.addClass("qd-loading");var i=n.serializeObject();return 0<s.id.length&&(i.id=s.id),$.ajax({url:"//mz-smart-newsletter-proxy.herokuapp.com/?jsnomeLoja=cartier&entity=DC",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(i),success:function(e){$(".success-message").removeClass("hide"),$(".main-form").addClass("hide"),n.trigger("QD.crmSuccess",[e])},error:function(e){"0"==e.status||"304"==e.status?alert("Este e-mail já está cadastrado na newsletter!"):alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){n.removeClass("qd-loading")}}),!1}},errorPlacement:function(e,n){}})}),$(window).on("QD.crmSuccess",function(e,n){$(".qd-v1-modal-newsletter");a="success"})}();