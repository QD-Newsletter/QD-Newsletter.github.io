!function(){var a="close";$(document).ready(function(){var n=$(".qd-v1-modal-newsletter");n.modal(),n.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn2Msg|"+a,"*")})}),$(function(){var n=$("form"),s=JSON.parse((decodeURIComponent(window.location.search).match(/code=([^&]+)/)||[""]).pop()||"{}");n.find('input[name="name"]').val(s.name||""),n.find('input[name="lastname"]').val(s.lastname||""),n.find('input[name="cpf"]').val(s.cpf||""),n.find('input[name="street"]').val(s.street||""),n.find('input[name="number"]').val(s.number||""),n.find('input[name="apartment"]').val(s.apartment||""),n.find('input[name="cep"]').val(s.cep||""),n.find('input[name="cellphone"]').val((s.cellphone||"").substring(3)),n.find('input[name="city"]').val(s.city||""),n.find('select[name="state"]').val(s.state||""),n.find('input[name="email"]').val(s.email||""),n.find('input[name="weddingAnniversary"], input[name="birthdate"]').mask("00/00/0000"),n.find('input[name="rg"]').mask("00.000.000-0"),n.find('input[name="cpf"]').mask("000.000.000-00"),n.find('input[name="cpf"]').mask("000.000.000-00"),n.find('input[name="cep"]').mask("00000-000"),n.find('input[name="homePhone"]').mask("(00) 0000-0000"),n.find('input[name="cellphone"]').mask(function(n){return 11===n.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},{onKeyPress:function(n,e,a,i){a.mask(SPMaskBehavior.apply({},arguments),i)}}),n.validate({rules:{email:{email:!0}},submitHandler:function(n){var e=$(n);if(e.valid()){var a=e.find('input[name="weddingAnniversary"], input[name="birthdate"]'),i=!1;if(a.each(function(){var n=$(this);moment(n.val(),"DD/MM/YYYY",!0).isValid()||(n.addClass("error"),n.is("[required]")&&(i=!0))}),i)return!1;e.addClass("qd-loading");var t=e.serializeObject();return 0<s.id.length&&(t.id=s.id),$.ajax({url:"//cartier.vtexcommercestable.com.br/api/dataentities/DC/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t),success:function(n){$(".success-message").removeClass("hide"),$(".main-form").addClass("hide"),e.trigger("QD.crmSuccess",[n])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){e.removeClass("qd-loading")}}),!1}},errorPlacement:function(n,e){}})}),$(window).on("QD.crmSuccess",function(n,e){$(".qd-v1-modal-newsletter");a="success"})}();