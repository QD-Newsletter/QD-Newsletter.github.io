!function(){var e="close";$(document).ready(function(){var o=$(".qd-v1-modal-newsletter");o.find(".qd-v1-modal-newsletter-step-1").show(),o.modal(),o.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn1Msg|"+e,"*")}),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}),$(function(){var e=$("form"),o="speedmotos",t="NL";e.find(".qd_news_phone").mask("(00) 0000-00009"),e.find(".qd_news_age").mask("00/00/0000");var n=e.find("[name=qd_phone]"),r=e.find("[name=qd_email]");e.each(function(){console.log("form = ",$(this)),$(this).validate({rules:{email:{email:!0}},submitHandler:function(e){var i=$(e);if(i.valid()){var s=i.find("[name]");n=n.filter(s),r=r.filter(s);var a=(n.val()||"").replace(/[^0-9]+/gi,"");n.val(a.length?"+55"+a:null),i.addClass("qd-loading");var c=function(e){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){r(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){r(e.ip)},error:function(e){r(null)}})}});var n=i.serializeObject(),r=function(r){n.userId=e,n.ip=r,$.ajax({url:"//api.vtexcrm.com.br/"+o+"/dataentities/"+t+"/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(n),success:function(e){i.addClass("qd-form-success"),i.trigger("QD.crmSuccess",[e])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){i.removeClass("qd-loading")}})}};return $.ajax({url:"//api.vtexcrm.com.br/"+o+"/dataentities/CL/search?_fields=id&email="+(r.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){c(e.length?e[0].id:null)},error:function(){c(null)}}),!1}},errorPlacement:function(e,o){}})})});var o=1;$(window).on("QD.crmSuccess",function(t,n){var r=$(".qd-v1-modal-newsletter");r.find('[class*="qd-v1-modal-newsletter-step"]').hide(),e="success",o++,2==o?r.find(".qd-v1-modal-newsletter-step-2").show():3==o&&r.find(".qd-v1-modal-newsletter-step-3").show();var i=$("form");i.find("[name=id]").remove(),i.append('<input type="hidden" name="id" value="'+(n.Id||"").split("-").pop()+'" />')})}();
