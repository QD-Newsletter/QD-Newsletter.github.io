!function(){var s="close";$(document).ready(function(){var e=$(".qd-v1-modal-newsletter");e.find(".qd-v1-modal-newsletter-step-1").show(),e.modal(),e.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn1Msg|"+s,"*")}),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}),$(function(){var e=$("form"),o="speedmotos";e.find(".qd_news_phone").mask("(00) 0000-00009"),e.find(".qd_news_age").mask("00/00/0000");var r=e.find("[name=qd_phone]"),i=e.find("[name=qd_email]");e.validate({rules:{email:{email:!0}},submitHandler:function(e){var s=$(e);if(s.valid()){var n=s.find("[name]");r=r.filter(n),i=i.filter(n);var a=(r.val()||"").replace(/[^0-9]+/gi,"");r.val(a.length?"+55"+a:null),s.addClass("qd-loading");var t=function(n){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){t(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){t(e.ip)},error:function(e){t(null)}})}});var a=s.serializeObject(),t=function(e){a.userId=n,a.ip=e,$.ajax({url:"//mz-smart-newsletter-proxy.herokuapp.com/?jsnomeLoja="+o+"&entity=NL",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(a),success:function(e){s.addClass("qd-form-success"),s.trigger("QD.crmSuccess",[e])},error:function(e){"0"==e.status||"304"==e.status?alert("Este e-mail já está cadastrado na newsletter!"):alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){s.removeClass("qd-loading")}})}};return $.ajax({url:"//mz-smart-newsletter-proxy.herokuapp.com/?jsnomeLoja="+o+"&entity=CL&email="+(i.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){e.length?t(e[0].id):t(null)},error:function(){t(null)}}),!1}},errorPlacement:function(e,n){}})});var o=1;$(window).on("QD.crmSuccess",function(e,n){var a=$(".qd-v1-modal-newsletter");a.find('[class*="qd-v1-modal-newsletter-step"]').hide(),s="success",2==++o?a.find(".qd-v1-modal-newsletter-step-2").show():3==o&&a.find(".qd-v1-modal-newsletter-step-3").show();var t=$("form");t.find("[name=id]").remove(),t.append('<input type="hidden" name="id" value="'+(n.Id||"").split("-").pop()+'" />')})}();