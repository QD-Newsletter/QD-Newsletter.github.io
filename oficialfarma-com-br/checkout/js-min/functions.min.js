!function(){var n="close";$(document).ready(function(){var e=$(".qd-v1-modal-newsletter");e.find(".qd-v1-modal-newsletter-step-1").show(),e.modal(),e.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn2Msg|"+n,"*")}),e.find("label").click(function(){var e=$(this).prev("input");e.is("[type=radio]")&&($(this).siblings("label").removeClass("selected"),$(this).addClass("selected"),$(e).click()),e.is("[type=checkbox]")&&(e.is(":checked")?e.removeAttr("checked"):e.attr("checked","checked"),$(this).toggleClass("selected"))}),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}),$(function(){var e=$("form"),c="oficialfarma",s=(location.search.match(/email=([^&]+)/i)||[""]).pop().trim();e.validate({rules:{email:{email:!0}},submitHandler:function(e){var i=$(e);if(i.valid()){i.find("[name]");i.addClass("qd-loading");var t=function(t){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){a(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){a(e.ip)},error:function(e){a(null)}})}});var n=i.serializeObject(),a=function(e){n.userId=t,n.ip=e,n.id=(s||"").toLowerCase().replace(/[^a-z0-9]/gi,function(e){return"-"+e.charCodeAt(0)+"-"}),n.qd_email=s||"",$.ajax({url:"//api.vtexcrm.com.br/"+c+"/dataentities/NE/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(n),success:function(e){i.addClass("qd-form-success"),i.trigger("QD.crmSuccess",[e])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){i.removeClass("qd-loading")}})}};return $.ajax({url:"//api.vtexcrm.com.br/"+c+"/dataentities/CL/search?_fields=id&email="+(s||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){e.length?t(e[0].id):t(null)},error:function(){t(null)}}),!1}},errorPlacement:function(e,t){}})}),$(window).on("QD.crmSuccess",function(e,t){$(".qd-v1-modal-newsletter");n="success"})}();