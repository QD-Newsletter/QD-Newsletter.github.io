!function(){var e="close";$(document).ready(function(){var n=$(".qd-v1-modal-newsletter");n.find(".qd-v1-modal-newsletter-step-1").show(),n.modal(),n.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn2Msg|"+e,"*")}),n.find(".form-radio-wrapper input[type=radio]").change(function(){$(this).siblings().removeClass("selected"),$(this).next("label").toggleClass("selected")}),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}),$(function(){var e=$("form"),n=(location.search.match(/email=([^&]+)/i)||[""]).pop().trim();e.validate({rules:{email:{email:!0}},submitHandler:function(e){var a=$(e);if(a.valid()){a.find("[name]");a.addClass("qd-loading");var t=function(e){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){o(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){o(e.ip)},error:function(){o(null)}})}});var t=a.serializeObject(),o=function(o){t.userId=e,t.ip=o,t.id=(n||"").toLowerCase().replace(/[^a-z0-9]/gi,function(e){return"-"+e.charCodeAt(0)+"-"}),t.qd_email=n||"",$.ajax({url:"//api.vtexcrm.com.br/oficialfarma/dataentities/NL/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t),success:function(e){a.addClass("qd-form-success"),a.trigger("QD.crmSuccess",[e])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){a.removeClass("qd-loading")}})}};return $.ajax({url:"//api.vtexcrm.com.br/oficialfarma/dataentities/CL/search?_fields=id&email="+(n||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){t(e.length?e[0].id:null)},error:function(){t(null)}}),!1}},errorPlacement:function(){}})}),$(window).on("QD.crmSuccess",function(){$(".qd-v1-modal-newsletter");e="success"})}();