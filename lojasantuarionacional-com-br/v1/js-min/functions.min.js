(function(){var f="close";$(document).ready(function(){var a=$(".qd-v1-modal-newsletter");a.find(".qd-v1-modal-newsletter-step-1").show();a.modal();a.on("hidden.bs.modal",function(){window.parent.postMessage("QdSn1Msg|"+f,"*")})});$(function(){var a=$("form");a.find(".qd_news_phone").mask("(00) 0000-00009");a.find(".qd_news_age").mask("00/00/0000");var c=a.find("[name=qd_phone]"),b=a.find("[name=qd_email]"),e=a.find("[name=qd_age]");a.validate({rules:{email:{email:!0},qd_age:{minlength:10}},submitHandler:function(a){var d= $(a);if(d.valid()){a=d.find("[name]");c=c.filter(a);b=b.filter(a);a=(c.val()||"").replace(/[^0-9]+/gi,"");c.val(a.length?"+55"+a:null);d.addClass("qd-loading");a=(e.val()||"").replace(/(\d+)\/(\d+)\/(\d+)/g,"$3-$2-$1");e.val(a);var f=function(a){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(a){c(a.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(a){c(a.ip)},error:function(a){c(null)}})}});var b=d.serializeObject(),c=function(c){b.userId= a;b.ip=c;$.ajax({url:"//api.vtexcrm.com.br/santuarionacional/dataentities/NL/documents",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(b),success:function(a){d.addClass("qd-form-success");d.trigger("QD.crmSuccess",[a])},error:function(){alert("Desculpe, n\u00e3o foi poss\u00edvel enviar seu formul\u00e1rio!")},complete:function(){d.removeClass("qd-loading")}})}};return $.ajax({url:"//api.vtexcrm.com.br/santuarionacional/dataentities/CL/search?_fields=id&email="+ (b.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(a){f(a.length?a[0].id:null)},error:function(){f(null)},complete:function(){d[0].reset()}}),!1}},errorPlacement:function(a,b){}})});var e=1;$(window).on("QD.crmSuccess",function(a,c){var b=$(".qd-v1-modal-newsletter");b.find('[class*="qd-v1-modal-newsletter-step"]').hide();f="success";e++;2==e?b.find(".qd-v1-modal-newsletter-step-2").show():3==e&&b.find(".qd-v1-modal-newsletter-step-3").show(); b=$("form");b.find("[name=id]").remove();c&&b.append('<input type="hidden" name="id" value="'+(c.Id||"").split("-").pop()+'" />')})})();