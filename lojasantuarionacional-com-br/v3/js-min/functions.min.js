!function(){var e="close";$(document).ready((function(){var n=$(".qd-v1-modal-newsletter");n.find(".qd-v1-modal-newsletter-step-1").show(),n.modal(),n.on("hidden.bs.modal",(function(){window.parent.postMessage("QdSn1Msg|"+e,"*")}))})),$((function(){var e=$("form");e.find(".qd_news_phone").mask("(00) 0000-00009"),e.find(".qd_news_age").mask("00/00/0000");var n=e.find("[name=qd_phone]"),a=e.find("[name=qd_email]"),o=e.find("[name=qd_age]");e.validate({rules:{email:{email:!0},qd_age:{minlength:10}},submitHandler:function(e){var t=$(e);if(t.valid()){e=t.find("[name]"),n=n.filter(e),a=a.filter(e),e=(n.val()||"").replace(/[^0-9]+/gi,""),n.val(e.length?"+55"+e:null),t.addClass("qd-loading"),e=(o.val()||"").replace(/(\d+)\/(\d+)\/(\d+)/g,"$3-$2-$1"),o.val(e);var s=function(e){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){a(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){a(e.ip)},error:function(e){a(null)}})}});var n=t.serializeObject(),a=function(a){n.userId=e,n.ip=a,$.ajax({url:"//mz-smart-newsletter-proxy2.herokuapp.com/?jsnomeLoja=santuarionacional&entity=NL",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(n),success:function(e){t.addClass("qd-form-success"),t.trigger("QD.crmSuccess",[e])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){t.removeClass("qd-loading")}})}};return $.ajax({url:"//mz-smart-newsletter-proxy2.herokuapp.com/?jsnomeLoja=santuarionacional&entity=CL&email="+(a.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){s(e.length?e[0].id:null)},error:function(){s(null)},complete:function(){t[0].reset()}}),!1}},errorPlacement:function(e,n){}})}));var n=1;$(window).on("QD.crmSuccess",(function(a,o){var t=$(".qd-v1-modal-newsletter");t.find('[class*="qd-v1-modal-newsletter-step"]').hide(),e="success",2==++n?t.find(".qd-v1-modal-newsletter-step-2").show():3==n&&t.find(".qd-v1-modal-newsletter-step-3").show();var s=$("form");s.find("[name=id]").remove(),o&&s.append('<input type="hidden" name="id" value="'+(o.Id||"").split("-").pop()+'" />')}))}();