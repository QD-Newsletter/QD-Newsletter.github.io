!function(){var n="close";$(document).ready(function(){var e=$(".newsletter-bar-qd-v1");e.find(".newsletter-bar-qd-v1-close").click(function(){e.toggleClass("qd-active"),window.parent.postMessage("QdSn1Msg|"+n,"*")}),e.addClass("qd-active"),$(".qd-content-coupon").html((location.search.match(/code=([^&]+)/i)||[""]).pop())}),$(function(){var e=$("form"),s="petmeupet",r=e.find("[name=qd_email]"),c=$(".newsletter-bar-qd-v1");e.validate({rules:{email:{email:!0}},submitHandler:function(e){var o=$(e);if(o.valid()){var n=o.find("[name]");r=r.filter(n),o.addClass("qd-loading");var a=function(n){$.ajax({url:"//api.ipify.org?format=jsonp",dataType:"jsonp",success:function(e){t(e.ip)},error:function(){$.ajax({url:"//www.telize.com/jsonip",dataType:"jsonp",success:function(e){t(e.ip)},error:function(){t(null)}})}});var a=o.serializeObject(),t=function(e){a.userId=n,a.ip=e,a.id=(r.val()||"").toLowerCase().replace(/[^a-z0-9]/gi,function(e){return"-"+e.charCodeAt(0)+"-"}),$.ajax({url:"//mz-smart-newsletter-proxy.herokuapp.com/?jsnomeLoja="+s+"&entity=NL",type:"PATCH",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json","Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(a),success:function(e){c.addClass("qd-success"),o.trigger("QD.crmSuccess",[e])},error:function(){alert("Desculpe, não foi possível enviar seu formulário!")},complete:function(){o.removeClass("qd-loading")}})}};return $.ajax({url:"//mz-smart-newsletter-proxy.herokuapp.com/?jsnomeLoja="+s+"&entity=CL&email="+(r.val()||"---"),type:"GET",dataType:"json",headers:{Accept:"application/vnd.vtex.ds.v10+json"},success:function(e){e.length?a(e[0].id):a(null)},error:function(){a(null)}}),!1}},errorPlacement:function(){}})}),$(window).on("QD.crmSuccess",function(){n="success"})}();